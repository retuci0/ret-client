package me.retucio.retclient.features.modules.exploit;

import me.retucio.retclient.features.modules.Module;
import me.retucio.retclient.features.settings.Setting;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Box;
import net.minecraft.util.math.Direction;
import net.minecraft.util.math.Vec3d;

import java.lang.Math;

//credits to mioclient for the src: https://github.com/mioclient/hitbox-desync

public class HitboxDesync extends Module {

	private final Setting<Boolean> disable = register(new Setting<>("Disable", true));
    private static final double MAGIC_OFFSET = 0.200009968835369999878673424677777777777761;

    public HitboxDesync() {
        super("HitboxDesync", "Crashes chinese crystal auras", Category.EXPLOIT, true, false, false);
    }

    @Override 
    public void onTick() {
        if (nullCheck()) return;
        
        Direction f = mc.player.getHorizontalFacing();
        Box bb = mc.player.getBoundingBox();
        
        Vec3d center = bb.getCenter();
        Vec3d offset = new Vec3d(f.getUnitVector());
        Vec3d fin = merge(Vec3d.of(BlockPos.ofFloored(center)).add(.5, 0, .5).add(offset.multiply(MAGIC_OFFSET)), f);
        
        mc.player.setPosition(
        		fin.x == 0 ? mc.player.getX() : fin.x,
                mc.player.getY(),
                fin.z == 0 ? mc.player.getZ() : fin.z
        );
        
        if (disable.getValue().booleanValue()) disable();
    }

    private Vec3d merge(Vec3d a, Direction facing) {
        return new Vec3d(a.x * Math.abs(facing.getUnitVector().x()), a.y * Math.abs(facing.getUnitVector().y()), a.z * Math.abs(facing.getUnitVector().z()));
    }
}
